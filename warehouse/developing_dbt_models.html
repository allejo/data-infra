
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Developing models in dbt &#8212; Cal-ITP Data Services</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding Data to the Warehouse" href="adding_oneoff_data.html" />
    <link rel="prev" title="What is an agency?" href="what_is_agency.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SZB618VNBZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-SZB618VNBZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/calitp_logo_MAIN.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Cal-ITP Data Services</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Data Services Documentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Analysts
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../analytics_welcome/overview.html">
   Welcome!
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_welcome/what_is_calitp.html">
     Cal-ITP Project Information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_welcome/how_we_work.html">
     How We Work
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../analytics_onboarding/overview.html">
   Technical Onboarding
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../analytics_tools/overview.html">
   Introduction to Analytics Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/github_setup.html">
     GitHub Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/tools_quick_links.html">
     Tools Quick Links
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/bi_dashboards.html">
     Business Insights &amp; Dashboards
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/jupyterhub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/python_libraries.html">
     Useful Python Libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/rt_analysis.html">
     RT Analysis Module
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/saving_code.html">
     Saving Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/storing_data.html">
     Storing Data During Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/data_catalogs.html">
     Using Data Catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_tools/knowledge_sharing.html">
     Helpful Links
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../analytics_new_analysts/overview.html">
   Tutorials for New Python Users
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/data-analysis-intro.html">
     Data Analysis: Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/data-analysis-intermediate.html">
     Data Analysis: Intermediate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/data-management.html">
     Data Management
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/notebooks.html">
     Working with Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/spatial-analysis-basics.html">
     Working with Geospatial Data: Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/spatial-analysis-intro.html">
     Working with Geospatial Data: Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/spatial-analysis-intermediate.html">
     Working with Geospatial Data: Intermediate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_new_analysts/spatial-analysis-advanced.html">
     Working with Geospatial Data: Advanced
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="overview.html">
   Introduction to the Warehouse
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="what_is_agency.html">
     What is an
     <code class="docutils literal notranslate">
      <span class="pre">
       agency
      </span>
     </code>
     ?
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Developing models in dbt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adding_oneoff_data.html">
     Adding Data to the Warehouse
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../datasets_and_tables/overview.html">
   Navigating the dbt Docs
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../analytics_examples/overview.html">
   Analysis Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_examples/warehouse_tutorial.html">
     Querying GTFS in the Data Warehouse
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_examples/new_tutorial.html">
     More Complex Queries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analytics_examples/sample-catalog-viewer.html">
     Sample Data Catalog
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../publishing/overview.html">
   Where can I publish data?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/1_publishing_principles.html">
     Data Publishing Principles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/2_static_files.html">
     Static Visualizations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/3_github_pages.html">
     HTML Visualizations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/4_analytics_portfolio_site.html">
     The Cal-ITP Analytics Portfolio
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/5_notebooks_styling.html">
     Getting Notebooks Ready for the Portfolio
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/6_metabase.html">
     Metabase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/7_gcs.html">
     GCS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/8_ckan.html">
     Publishing data to California Open Data aka CKAN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../publishing/sections/9_map_tiles.html">
     Map tiles
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developers
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../architecture/architecture_overview.html">
   Architecture Overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../airflow/overview.html">
   Airflow
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../airflow/dags-maintenance.html">
     Production DAGs Maintenance
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../kubernetes/README.html">
   Kubernetes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../kubernetes/JupyterHub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../kubernetes/architecture.html">
     architecture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../kubernetes/deployment.html">
     deployment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ci/README.html">
   CI
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/Git-Flow-Services.html">
     Git Flow for Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/Pipeline-Variables.html">
     Pipeline Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/build-docker-image.html">
     build-docker-image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/build-git-notes.html">
     build-git-notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/build-git-tag.html">
     build-git-tag
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/configure-build-git-notes.html">
     configure-build-git-notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/configure-docker-login.html">
     configure-docker-login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/configure-git-remote.html">
     configure-git-remote
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/release-kube-overlay.html">
     release-kube-overlay
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/validate-build-git-tag.html">
     validate-build-git-tag
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ci/steps/validate-clean-worktree.html">
     validate-clean-worktree
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../github/contribute_to_repos.html">
   Contributing to Data Services Repos
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../services/overview.html">
   Services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../services/gtfs-ckan-uploader.html">
     GTFS CKAN Uploader
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../backups/metabase.html">
   Backups
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contribute to the Docs!
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../contribute/overview.html">
   Getting Started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../contribute/contribute-best-practices.html">
     Best Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../contribute/submitting_changes.html">
     Submitting Changes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../contribute/content_types.html">
     Common Content
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/warehouse/developing_dbt_models.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cal-itp/data-infra/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/cal-itp/data-infra//issues/new?title=Issue%20on%20page%20%2Fwarehouse/developing_dbt_models.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/cal-itp/data-infra/edit/main/docs/warehouse/developing_dbt_models.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-contribute-to-the-dbt-project">
   How to contribute to the dbt project
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-started">
     Getting started
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-workflow">
     Developer workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeling-considerations">
   Modeling considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#when-to-develop-or-update-a-model">
     When to develop or update a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#materializations-performance-and-cost">
     Materializations, performance, and cost
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helpful-talks-and-presentations">
   Helpful talks and presentations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbt-at-cal-itp-introduction">
     dbt at Cal-ITP introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coalesce">
     Coalesce
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Developing models in dbt</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-contribute-to-the-dbt-project">
   How to contribute to the dbt project
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-started">
     Getting started
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-workflow">
     Developer workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeling-considerations">
   Modeling considerations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#when-to-develop-or-update-a-model">
     When to develop or update a model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#materializations-performance-and-cost">
     Materializations, performance, and cost
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helpful-talks-and-presentations">
   Helpful talks and presentations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dbt-at-cal-itp-introduction">
     dbt at Cal-ITP introduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coalesce">
     Coalesce
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="developing-models-in-dbt">
<span id="developing-dbt-models"></span><h1>Developing models in dbt<a class="headerlink" href="#developing-models-in-dbt" title="Permalink to this headline">¶</a></h1>
<p>Information related to contributing to the <a class="reference external" href="https://github.com/cal-itp/data-infra/tree/main/warehouse">Cal-ITP dbt project</a>.</p>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If you have questions specific to our project or you encounter any issues when developing, please reach out in the <code class="docutils literal notranslate"><span class="pre">#data-warehouse-devs</span></code> or <code class="docutils literal notranslate"><span class="pre">#data-office-hours</span></code> Cal-ITP Slack channels.</p></li>
<li><p>For Cal-ITP-specific data warehouse documentation, including high-level concepts and naming conventions, see <a class="reference external" href="https://dbt-docs.calitp.org/#%21/overview">our Cal-ITP dbt documentation site</a>. This documentation is automatically generated by dbt, and incorporates the table- and column-level documentation that developers enter in YAML files in the dbt project.</p></li>
<li><p>For general dbt concepts (for example, dbt <a class="reference external" href="https://docs.getdbt.com/guides/advanced/using-jinja">Jinja</a> or <a class="reference external" href="https://docs.getdbt.com/docs/build/tests">tests</a>), see the <a class="reference external" href="https://docs.getdbt.com/docs/introduction">general dbt documentation site</a></p></li>
<li><p>For general SQL or BigQuery concepts (for example, <a class="reference external" href="https://cloud.google.com/bigquery/docs/tables-intro">tables</a>, <a class="reference external" href="https://cloud.google.com/bigquery/docs/views-intro">views</a>, or <a class="reference external" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/window-function-calls">window functions</a>), see the <a class="reference external" href="https://cloud.google.com/bigquery/docs">BigQuery docs site</a>.</p></li>
</ul>
</div>
<div class="section" id="how-to-contribute-to-the-dbt-project">
<h2>How to contribute to the dbt project<a class="headerlink" href="#how-to-contribute-to-the-dbt-project" title="Permalink to this headline">¶</a></h2>
<div class="section" id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>To get set up to contribute to the dbt project via JupyterHub, follow <a class="reference external" href="https://github.com/cal-itp/data-infra/blob/main/warehouse/README.md#setting-up-the-project-in-your-jupyterhub-personal-server">the README in the data-infra repo warehouse folder</a>. If you hit any trouble with setup, let folks know in the #data-warehouse-devs or #data-office-hours channel in the Cal-ITP Slack.</p>
<p>We also recommend that everyone who does dbt development joins the <code class="docutils literal notranslate"><span class="pre">#data-warehouse-devs</span></code> channel in the Cal-ITP Slack workspace to ask questions, collaborate, and build shared knowledge.</p>
</div>
<div class="section" id="developer-workflow">
<h3>Developer workflow<a class="headerlink" href="#developer-workflow" title="Permalink to this headline">¶</a></h3>
<p>To test your work while developing dbt models, you can edit the <code class="docutils literal notranslate"><span class="pre">.sql</span></code> files for your models, save your changes, and then <a class="reference external" href="https://github.com/cal-itp/data-infra/tree/main/warehouse#dbt-commands">run the model from the command line</a> to execute the SQL you updated.</p>
<p>To inspect tables as you are working, the fastest method is usually to run some manual test queries or “preview” the tables in the <a class="reference external" href="https://console.cloud.google.com/bigquery?project=cal-itp-data-infra-staging">BigQuery user interface</a>. You can also use something like <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_gbq.html"><code class="docutils literal notranslate"><span class="pre">pandas.read_gbq</span></code></a> to perform example queries in a notebook.</p>
<p>When you run dbt commands locally on JupyterHub, your models will be created in the <code class="docutils literal notranslate"><span class="pre">cal-itp-data-infra-staging.&lt;your</span> <span class="pre">name&gt;_&lt;dbt</span> <span class="pre">folder</span> <span class="pre">name,</span> <span class="pre">like</span> <span class="pre">mart_gtfs&gt;</span></code> BigQuery dataset. Note that this is in the <code class="docutils literal notranslate"><span class="pre">cal-itp-data-infra-staging</span></code> Google Cloud Platform project, <em>not</em> the production <code class="docutils literal notranslate"><span class="pre">cal-itp-data-infra</span></code> project.</p>
<p>Once your models are working the way you want, please make sure to update the associated YAML files (there will generally be one or two YAML files per folder with model tests, documentation, and additional configuration.) Especially if you created a brand-new model, you will want to add tests for things like unique, non-null primary keys and valid foreign keys. The YAML is also where table- and column-level documentation is populated. <a class="reference external" href="https://github.com/cal-itp/data-infra/blob/main/warehouse/models/mart/gtfs/_mart_gtfs_dims.yml">Here is an example YAML file from our project</a>, and <a class="reference external" href="https://github.com/cal-itp/data-infra/pull/2097">here is an example PR that created a new mart table with accompanying documentation</a>.</p>
<p>Because the warehouse is collectively maintained and changes can affect a variety of users, please open PRs against <code class="docutils literal notranslate"><span class="pre">main</span></code> when work is ready to merge and keep an eye out for comments and questions from reviewers, who might require tweaks before merging. (<a class="reference internal" href="../github/contribute_to_repos.html#contribute-to-repos"><span class="std std-ref">See our repo contribution page</span></a> for more information on GitHub practices.)</p>
</div>
</div>
<div class="section" id="modeling-considerations">
<h2>Modeling considerations<a class="headerlink" href="#modeling-considerations" title="Permalink to this headline">¶</a></h2>
<p>When developing dbt models, there are some considerations which may differ from considerations for a notebook-based analysis.</p>
<div class="section" id="when-to-develop-or-update-a-model">
<h3>When to develop or update a model<a class="headerlink" href="#when-to-develop-or-update-a-model" title="Permalink to this headline">¶</a></h3>
<p>One key question to ask is whether a given data need is best met by a new dbt model or updates to an existing model vs. some other tool or process.</p>
<p>Changes to dbt models are likely to be appropriate, and often beneficial over other approaches, when one or more of the following is true:</p>
<ul class="simple">
<li><p>There is a consistent or ongoing need for the same transformations. dbt can ensure that transformations are performed consistently at scale, every day.</p></li>
<li><p>Transformations are needed on large data. Doing transformations in BigQuery can be more performant than doing them in notebooks or any workflow where the large data must be loaded into local memory.</p></li>
<li><p>We want to use the same model across multiple domains or tools. The BigQuery data warehouse is the easiest way to provide consistent data throughout the Cal-ITP data ecosystem (in JupyterHub, Metabase, open data publishing, the reports site, etc.)</p></li>
</ul>
<p>dbt model updates may not be appropriate when:</p>
<ul class="simple">
<li><p>There is insufficient support in dbt or BigQuery for the necessary tooling. The biggest current example is geospatial work; once we have <a class="reference external" href="https://github.com/cal-itp/data-infra/issues/2359">Python models in the dbt project</a>, there will be fewer limitations.</p></li>
<li><p>You are doing exploratory data analysis, especially on inconsistently-constructed data. It will almost always be faster to do initial exploration of data via Jupyter/Python than in SQL.</p></li>
</ul>
</div>
<div class="section" id="materializations-performance-and-cost">
<h3>Materializations, performance, and cost<a class="headerlink" href="#materializations-performance-and-cost" title="Permalink to this headline">¶</a></h3>
<p>Because the dbt project is run and built every day, we want to be mindful of cost and be efficient in how we build and structure our models. The <a class="reference external" href="https://docs.getdbt.com/docs/build/materializations#overview">dbt docs materializations page</a> provides a good overview of different materialization options and associated considerations.</p>
<p>When developing a new model, or updating an existing model, it is helpful to keep an eye on the number of bytes billed to build the model (this information is printed in the terminal output from dbt.) As a rule of thumb in our project, models that take more than 100 GB to build should probably be optimized a bit more, potentially by being made <a class="reference external" href="https://docs.getdbt.com/docs/build/materializations#incremental">incremental</a>.</p>
<p>Performance is one of the hardest things to manage when you are new to developing in SQL, so please don’t hesitate to ask questions (the <code class="docutils literal notranslate"><span class="pre">#data-warehouse-devs</span></code> or <code class="docutils literal notranslate"><span class="pre">#data-office-hours</span></code> Cal-ITP Slack channels are good places to ask) as you get used to the options.</p>
</div>
</div>
<div class="section" id="helpful-talks-and-presentations">
<h2>Helpful talks and presentations<a class="headerlink" href="#helpful-talks-and-presentations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dbt-at-cal-itp-introduction">
<h3>dbt at Cal-ITP introduction<a class="headerlink" href="#dbt-at-cal-itp-introduction" title="Permalink to this headline">¶</a></h3>
<p>In 2022, Laurie <a class="reference external" href="https://cal-itp.slack.com/archives/C02NJRV9QUB/p1651082191730229?thread_ts=1650648699.809809&amp;cid=C02NJRV9QUB">gave a lunch and learn</a> about why we are using dbt at Cal-ITP.</p>
</div>
<div class="section" id="coalesce">
<h3>Coalesce<a class="headerlink" href="#coalesce" title="Permalink to this headline">¶</a></h3>
<p>Some folks from Data Services attended Coalesce (dbt’s conference) in 2022 and thought the following talks may be of interest:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=EYdb1x1cO9U&amp;list=PL0QYlrC86xQlj9UDGiEwhXQuSjuSyPJHl&amp;index=66">The accidental analytics engineer by Michael Chow</a> - this talk outlines some differences Michael has experienced between R/tidyverse and dbt/MDS (modern data stack) approaches to working with data</p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=0SDp1yTK2zc&amp;list=PL0QYlrC86xQlj9UDGiEwhXQuSjuSyPJHl&amp;index=112">dbt and MDS in small-batch academic research</a> - this talk outlines some benefits this researcher found to using dbt in an academic context; note that he uses DuckDB (instead of BigQuery)</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./warehouse"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="what_is_agency.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">What is an <code class="docutils literal notranslate"><span class="pre">agency</span></code>?</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="adding_oneoff_data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Adding Data to the Warehouse</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Cal-ITP<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>