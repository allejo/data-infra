
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Publishing data to California Open Data aka CKAN &#8212; Cal-ITP Data Services</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Map tiles" href="9_map_tiles.html" />
    <link rel="prev" title="GCS" href="7_gcs.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SZB618VNBZ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-SZB618VNBZ');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/calitp_logo_MAIN.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Cal-ITP Data Services</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Data Services Documentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Analysts
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../analytics_welcome/overview.html">
   Welcome!
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_welcome/what_is_calitp.html">
     Cal-ITP Project Information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_welcome/how_we_work.html">
     How We Work
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../analytics_onboarding/overview.html">
   Technical Onboarding
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../analytics_tools/overview.html">
   Introduction to Analytics Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/github_setup.html">
     GitHub Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/tools_quick_links.html">
     Tools Quick Links
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/bi_dashboards.html">
     Business Insights &amp; Dashboards
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/notebooks.html">
     Notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/python_libraries.html">
     Useful Python Libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/saving_code.html">
     Saving Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/storing_data.html">
     Storing Data During Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/data_catalogs.html">
     Using Data Catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_tools/knowledge_sharing.html">
     Helpful Links
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../analytics_new_analysts/overview.html">
   Tutorials for New Python Users
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/data-analysis-intro.html">
     Data Analysis: Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/data-analysis-intermediate.html">
     Data Analysis: Intermediate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/data-management.html">
     Data Management
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/notebooks.html">
     Working with Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/spatial-analysis-basics.html">
     Working with Geospatial Data: Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/spatial-analysis-intro.html">
     Working with Geospatial Data: Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/spatial-analysis-intermediate.html">
     Working with Geospatial Data: Intermediate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_new_analysts/spatial-analysis-advanced.html">
     Working with Geospatial Data: Advanced
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../warehouse/overview.html">
   Introduction to the Warehouse
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../warehouse/what_is_agency.html">
     What is an
     <code class="docutils literal notranslate">
      <span class="pre">
       agency
      </span>
     </code>
     ?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../warehouse/table_naming.html">
     Table Naming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../warehouse/adding_oneoff_data.html">
     Adding Data to the Warehouse
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../warehouse/metrics.html">
     Metric Views
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../warehouse/sql_snippets.html">
     Helpful SQL Snippets
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../datasets_and_tables/overview.html">
   Datasets &amp; Tables
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/navigating_dbt_docs.html">
     Navigating the dbt Docs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/views.html">
     Views
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/amplitude.html">
     Amplitude
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/gtfs_schedule.html">
     GTFS Schedule
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/gtfs_realtime.html">
     GTFS Realtime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/transitdatabase.html">
     Transit Database
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../datasets_and_tables/mst_payments.html">
     MST Payments (WIP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../analytics_examples/overview.html">
   Analysis Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_examples/warehouse_tutorial.html">
     Querying GTFS in the Data Warehouse
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_examples/new_tutorial.html">
     More Complex Queries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../analytics_examples/sample-catalog-viewer.html">
     Sample Data Catalog
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../overview.html">
   Where can I publish data?
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1_publishing_principles.html">
     Data Publishing Principles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_static_files.html">
     Static Visualizations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="3_github_pages.html">
     HTML Visualizations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_analytics_portfolio_site.html">
     The Cal-ITP Analytics Portfolio
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_notebooks_styling.html">
     Getting Notebooks Ready for the Portfolio
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="6_metabase.html">
     Metabase
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="7_gcs.html">
     GCS
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Publishing data to California Open Data aka CKAN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9_map_tiles.html">
     Map tiles
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Developers
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../architecture/architecture_overview.html">
   Architecture Overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../airflow/overview.html">
   Airflow
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/local-setup.html">
     Local Airflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/static-schedule-pipeline.html">
     Static Schedule Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/production-maintenance.html">
     Production Maintenance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/dags-maintenance.html">
     DAGs Maintenance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/agencies.html">
     Agency GTFS Feeds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../airflow/views.html">
     Creating New Tables (Views)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../kubernetes/README.html">
   Kubernetes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kubernetes/JupyterHub.html">
     JupyterHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kubernetes/architecture.html">
     architecture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../kubernetes/deployment.html">
     deployment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ci/README.html">
   CI
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/Git-Flow-Services.html">
     Git Flow for Services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/Pipeline-Variables.html">
     Pipeline Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/build-docker-image.html">
     build-docker-image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/build-git-notes.html">
     build-git-notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/build-git-tag.html">
     build-git-tag
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/configure-build-git-notes.html">
     configure-build-git-notes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/configure-docker-login.html">
     configure-docker-login
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/configure-git-remote.html">
     configure-git-remote
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/release-kube-overlay.html">
     release-kube-overlay
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/validate-build-git-tag.html">
     validate-build-git-tag
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ci/steps/validate-clean-worktree.html">
     validate-clean-worktree
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../github/contribute_to_repos.html">
   Contributing to Data Services Repos
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../services/overview.html">
   Services
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../services/gtfs-ckan-uploader.html">
     GTFS CKAN Uploader
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../services/gtfs-rt-archive.html">
     gtfs-rt-archive
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../backups/metabase.html">
   Backups
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contribute to the Docs!
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../contribute/overview.html">
   Getting Started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../contribute/contribute-best-practices.html">
     Best Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../contribute/submitting_changes.html">
     Submitting Changes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../contribute/content_types.html">
     Common Content
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/publishing/sections/8_ckan.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cal-itp/data-infra/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/cal-itp/data-infra//issues/new?title=Issue%20on%20page%20%2Fpublishing/sections/8_ckan.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/cal-itp/data-infra/edit/main/docs/publishing/sections/8_ckan.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-the-california-open-data-portal">
   What is the California Open Data Portal?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cal-itp-data-sets">
   Cal-ITP data sets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-process">
   General process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#develop-data-models">
     Develop data models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-data">
     Document data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-dataset-and-metadata">
     Create dataset and metadata
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#publish-the-data">
     Publish the data!
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Publishing data to California Open Data aka CKAN</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-the-california-open-data-portal">
   What is the California Open Data Portal?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cal-itp-data-sets">
   Cal-ITP data sets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-process">
   General process
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#develop-data-models">
     Develop data models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-data">
     Document data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-dataset-and-metadata">
     Create dataset and metadata
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#publish-the-data">
     Publish the data!
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="publishing-data-to-california-open-data-aka-ckan">
<span id="publishing-ckan"></span><h1>Publishing data to California Open Data aka CKAN<a class="headerlink" href="#publishing-data-to-california-open-data-aka-ckan" title="Permalink to this headline">¶</a></h1>
<p>NOTE: Only non-spatial data should be directly published to CKAN. Spatial data
(i.e. data keyed by location in some manner) has to go through the Caltrans
geoportal and is subsequently synced to CKAN.</p>
<div class="section" id="what-is-the-california-open-data-portal">
<h2>What is the California Open Data Portal?<a class="headerlink" href="#what-is-the-california-open-data-portal" title="Permalink to this headline">¶</a></h2>
<p>The state of California hosts its own instance of CKAN, called the <a class="reference external" href="https://data.ca.gov/">California Open Data Portal</a>.
<a class="reference external" href="https://ckan.org/">CKAN</a> is an open-source data management tool; in other words,
it allows organizations such as Caltrans to host data so that users can search
for and download data sets that might be useful for analysis or research. Among
other agencies, Caltrans publishes <a class="reference external" href="https://data.ca.gov/organization/caltrans">many data sets</a> to CKAN.
Data is generally published as flat files (typically CSV) alongside required
metadata and a data dictionary.</p>
</div>
<div class="section" id="cal-itp-data-sets">
<h2>Cal-ITP data sets<a class="headerlink" href="#cal-itp-data-sets" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://data.ca.gov/dataset/cal-itp-gtfs-ingest-pipeline-dataset">Cal-ITP GTFS Schedule Data</a></p></li>
</ul>
</div>
<div class="section" id="general-process">
<h2>General process<a class="headerlink" href="#general-process" title="Permalink to this headline">¶</a></h2>
<div class="section" id="develop-data-models">
<h3>Develop data models<a class="headerlink" href="#develop-data-models" title="Permalink to this headline">¶</a></h3>
<p>Generally, data models should be built in dbt/BigQuery if possible. For example,
we have <a class="reference external" href="https://github.com/cal-itp/data-infra/tree/main/warehouse/models/gtfs_schedule_latest_only">latest-only GTFS schedule models</a>
we can use to update and expand the existing <a class="reference external" href="https://data.ca.gov/dataset/cal-itp-gtfs-ingest-pipeline-dataset">CKAN dataset</a>
<a class="reference external" href="https://dbt-docs.calitp.org/#%21/model/model.calitp_warehouse.agency">latest-only agency</a></p>
</div>
<div class="section" id="document-data">
<h3>Document data<a class="headerlink" href="#document-data" title="Permalink to this headline">¶</a></h3>
<p>California Open Data requires two documentation files for published datasets.</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> - one row per resource (i.e. file) to be published</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dictionary.csv</span></code> - one row per column across all resources</p></li>
</ol>
<p>If you are using dbt exposure-based data publishing, you can automatically generate
these two files using the main <code class="docutils literal notranslate"><span class="pre">publish.py</span></code> script (specifically the <code class="docutils literal notranslate"><span class="pre">generate-exposure-documentation</span></code>
subcommand). The documentation from the dbt models’ corresponding YAML will be
converted into appropriate CSVs and written out locally.</p>
<p>Run this command inside the <code class="docutils literal notranslate"><span class="pre">warehouse</span></code> folder, assuming you have local dbt
artifacts in <code class="docutils literal notranslate"><span class="pre">target/</span></code> from a <code class="docutils literal notranslate"><span class="pre">dbt</span> <span class="pre">run</span></code> or <code class="docutils literal notranslate"><span class="pre">dbt</span> <span class="pre">compile</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry run python scripts/publish.py document-exposure california_open_data
</pre></div>
</div>
</div>
<div class="section" id="create-dataset-and-metadata">
<h3>Create dataset and metadata<a class="headerlink" href="#create-dataset-and-metadata" title="Permalink to this headline">¶</a></h3>
<p>Once you’ve generated the necessary metadata and dictionary CSV, you need to get
approval from Chad Baker. Send the CSVs via email, preferably CC’ing somebody
with a Caltrans email.</p>
<p>Once approved, a CKAN dataset will be created with UUIDs corresponding to each
model that will be published. If you are using dbt exposures, you will need to
update the <code class="docutils literal notranslate"><span class="pre">meta</span></code> field to map the dbt models to the appropriate UUIDs.</p>
<p>An example from the latest-only GTFS data exposure.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">meta</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">methodology</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">        </span><span class="no">Cal-ITP collects the GTFS feeds from a statewide list [link] every night and aggegrates it into a statewide table</span><span class="w"></span>
<span class="w">        </span><span class="no">for analysis purposes only. Do not use for trip planner ingestation, rather is meant to be used for statewide</span><span class="w"></span>
<span class="w">        </span><span class="no">analytics and other use cases. Note: These data may or may or may not have passed GTFS-Validation.</span><span class="w"></span>
<span class="w">      </span><span class="nt">coordinate_system_epsg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4326&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">destinations</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ckan</span><span class="w"></span>
<span class="w">          </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csv</span><span class="w"></span>
<span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://data.ca.gov</span><span class="w"></span>
<span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">agency</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">e8f9d49e-2bb6-400b-b01f-28bc2e0e7df2</span><span class="w"></span>
<span class="w">              </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">                </span><span class="no">Each row is a cleaned row from an agency.txt file.</span><span class="w"></span>
<span class="w">                </span><span class="no">Definitions for the original GTFS fields are available at:</span><span class="w"></span>
<span class="w">                </span><span class="no">https://gtfs.org/reference/static#agencytxt.</span><span class="w"></span>
<span class="w">            </span><span class="nt">attributions</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">038b7354-06e8-4082-a4a1-40debd3110d5</span><span class="w"></span>
<span class="w">              </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">                </span><span class="no">Each row is a cleaned row from an attributions.txt file.</span><span class="w"></span>
<span class="w">                </span><span class="no">Definitions for the original GTFS fields are available at:</span><span class="w"></span>
<span class="w">                </span><span class="no">https://gtfs.org/reference/static#attributionstxt.</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="publish-the-data">
<h3>Publish the data!<a class="headerlink" href="#publish-the-data" title="Permalink to this headline">¶</a></h3>
<p>If you are using dbt-based publishing, the <code class="docutils literal notranslate"><span class="pre">publish_exposure</span></code> subcommand of <code class="docutils literal notranslate"><span class="pre">publish.py</span></code>
will query BigQuery, write out CSV files, and upload those files to CKAN.
Either create an Airflow job to refresh/update the data at the specified
frequency, or do it manually. You can use flags to execute a dry run or write to
GCS without also uploading to CKAN.</p>
<p>The publish script supports referencing <code class="docutils literal notranslate"><span class="pre">gs://</span></code> paths for the manifest; by default,
the script will read the latest manifest in GCS uploaded by an Airflow job.
You may also choose to run dbt models and/or run the publish script locally; these
operations can be mixed-and-matched. If you are running <code class="docutils literal notranslate"><span class="pre">publish.py</span></code> locally, you
will need to set <code class="docutils literal notranslate"><span class="pre">$CALITP_CKAN_GTFS_SCHEDULE_KEY</span></code> ahead of time.</p>
<p>By default, the script will upload artifacts to GCS, but will not actually
upload data to CKAN. In addition, the script will upload the metadata and dictionary
files to GCS for eventual sharing with Caltrans.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ poetry run python scripts/publish.py publish-exposure california_open_data --manifest ./target/manifest.json
reading manifest from ./target/manifest.json
would be writing to gs://test-calitp-publish/california_open_data__metadata/dt<span class="o">=</span><span class="m">2022</span>-08-30/ts<span class="o">=</span><span class="m">2022</span>-08-30T20:46:00.474199Z/metadata.csv
would be writing to gs://test-calitp-publish/california_open_data__dictionary/dt<span class="o">=</span><span class="m">2022</span>-08-30/ts<span class="o">=</span><span class="m">2022</span>-08-30T20:46:00.474199Z/dictionary.csv
handling agency e8f9d49e-2bb6-400b-b01f-28bc2e0e7df2
...
writing <span class="m">346</span> rows <span class="o">(</span><span class="m">42</span>.9 kB<span class="o">)</span> from andrew_gtfs_schedule.agency to gs://test-calitp-publish/california_open_data__agency/dt<span class="o">=</span><span class="m">2022</span>-08-30/ts<span class="o">=</span><span class="m">2022</span>-08-30T20:46:00.474199Z/agency.csv
would be uploading to https://data.ca.gov e8f9d49e-2bb6-400b-b01f-28bc2e0e7df2 <span class="k">if</span> --publish
...
</pre></div>
</div>
<p>You can add the <code class="docutils literal notranslate"><span class="pre">--publish</span></code> flag to actually upload artifacts to CKAN after they
are written to GCS. You must be using a production bucket to publish, either
by setting <code class="docutils literal notranslate"><span class="pre">$CALITP_BUCKET__PUBLISH</span></code> or using the <code class="docutils literal notranslate"><span class="pre">--bucket</span></code> flag. In addition,
you may specify a manifest file in GCS if desired.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry run python scripts/publish.py publish-exposure california_open_data --bucket gs://calitp-publish --manifest gs://calitp-dbt-artifacts/latest/manifest.json --publish
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./publishing/sections"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="7_gcs.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">GCS</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="9_map_tiles.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Map tiles</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Cal-ITP<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>