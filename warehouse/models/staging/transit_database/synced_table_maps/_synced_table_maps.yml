version: 2

models:
  - name: base_tts_services_ct_services_map
    description: |
      Mapping between two instances of synced `services` table in Airtable;
      one copy in California Transit base and the other in Transit
      Technology Stacks base. Different Airtable internal record IDs
      are assigned in each instance so this table maps the IDs between
      instances, using `name` (Airtable primary field) to join.
    tests:
      - dbt_utils.mutually_exclusive_ranges:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: ct_name
          gaps: required
      - dbt_utils.mutually_exclusive_ranges:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: tts_name
          gaps: required
      - range_gaps_are_microseconds:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: ct_name
      - range_gaps_are_microseconds:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: tts_name
    columns:
      - name: ct_name
        tests:
          - not_null
      - name: ct_record_id
        tests:
          - not_null
      - name: tts_name
        tests:
          - not_null
      - name: tts_record_id
        tests:
          - not_null

  - name: base_tts_organizations_ct_organizations_map
    description: |
      Mapping between two instances of synced `organization` table in Airtable;
      one copy in California Transit base and the other in Transit
      Technology Stacks base. Different Airtable internal record IDs
      are assigned in each instance so this table maps the IDs between
      instances, using `name` (Airtable primary field) to join.
    tests:
      - dbt_utils.mutually_exclusive_ranges:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: ct_name
          gaps: required
      - dbt_utils.mutually_exclusive_ranges:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: tts_name
          gaps: required
      - range_gaps_are_microseconds:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: ct_name
      - range_gaps_are_microseconds:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: tts_name
    columns:
      - name: ct_name
        tests:
          - not_null
      - name: ct_record_id
        tests:
          - not_null
      - name: tts_name
        tests:
          - not_null
      - name: tts_record_id
        tests:
          - not_null
