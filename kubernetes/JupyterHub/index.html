
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://docs.calitp.org/data-infra/kubernetes/JupyterHub/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>JupyterHub - Juniper Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    
      

  


  

  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SZB618VNBZ"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-SZB618VNBZ",{page_path:t.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZB618VNBZ"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jupyterhub" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Juniper Documentation" class="md-header__button md-logo" aria-label="Juniper Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Juniper Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JupyterHub
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/cal-itp/data-infra/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../datasets/01_overview/" class="md-tabs__link">
        Datasets
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Kubernetes
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../services/gtfs-ckan-uploader/" class="md-tabs__link">
        Services
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../warehouse/01_agencies/" class="md-tabs__link">
        Warehouse
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Juniper Documentation" class="md-nav__button md-logo" aria-label="Juniper Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Juniper Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cal-itp/data-infra/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Datasets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Datasets" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Datasets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/01_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/gtfs_schedule/" class="md-nav__link">
        GTFS Schedule
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/mst_payments/" class="md-nav__link">
        MST Payments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/transitstacks/" class="md-nav__link">
        Transitstacks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/views/" class="md-nav__link">
        Views
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        kubernetes #
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          JupyterHub
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        JupyterHub
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-the-namespace" class="md-nav__link">
    1. Create the Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-add-secrets-to-namespace" class="md-nav__link">
    2. Add Secrets to Namespace
  </a>
  
    <nav class="md-nav" aria-label="2. Add Secrets to Namespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyterhub-gcloud-service-key" class="md-nav__link">
    jupyterhub-gcloud-service-key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jupyterhub-github-config" class="md-nav__link">
    jupyterhub-github-config
  </a>
  
    <nav class="md-nav" aria-label="jupyterhub-github-config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-temporary-file" class="md-nav__link">
    Create a Temporary File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fill-the-file-with-chart-formatted-secrets" class="md-nav__link">
    Fill the File with Chart-Formatted Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encode-the-file-contents" class="md-nav__link">
    Encode the File Contents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-encoding-to-your-secret" class="md-nav__link">
    Add the Encoding to Your Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reminder-apply-the-secrets-file" class="md-nav__link">
    Reminder - Apply the secrets file!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-install-the-helm-chart" class="md-nav__link">
    3. Install the Helm Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating" class="md-nav__link">
    Updating
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-name-changes" class="md-nav__link">
    Domain Name Changes
  </a>
  
    <nav class="md-nav" aria-label="Domain Name Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changes-in-github-oauth" class="md-nav__link">
    Changes in GitHub OAuth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changes-in-the-helm-chart" class="md-nav__link">
    Changes in the Helm Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Services" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../services/gtfs-ckan-uploader/" class="md-nav__link">
        GTFS CKAN Uploader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../services/gtfs-rt-archive/" class="md-nav__link">
        gtfs-rt-archive
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Warehouse
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Warehouse" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Warehouse
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/01_agencies/" class="md-nav__link">
        Agency GTFS Feeds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/02_views/" class="md-nav__link">
        Creating New Tables (Views)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/03_metrics/" class="md-nav__link">
        Metric Views
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/04_sql_snippets/" class="md-nav__link">
        SQL Snippets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/05_using_metabase/" class="md-nav__link">
        Using Metabase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../warehouse/table_names/" class="md-nav__link">
        Table names
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-the-namespace" class="md-nav__link">
    1. Create the Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-add-secrets-to-namespace" class="md-nav__link">
    2. Add Secrets to Namespace
  </a>
  
    <nav class="md-nav" aria-label="2. Add Secrets to Namespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jupyterhub-gcloud-service-key" class="md-nav__link">
    jupyterhub-gcloud-service-key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jupyterhub-github-config" class="md-nav__link">
    jupyterhub-github-config
  </a>
  
    <nav class="md-nav" aria-label="jupyterhub-github-config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-temporary-file" class="md-nav__link">
    Create a Temporary File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fill-the-file-with-chart-formatted-secrets" class="md-nav__link">
    Fill the File with Chart-Formatted Secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encode-the-file-contents" class="md-nav__link">
    Encode the File Contents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-the-encoding-to-your-secret" class="md-nav__link">
    Add the Encoding to Your Secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reminder-apply-the-secrets-file" class="md-nav__link">
    Reminder - Apply the secrets file!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-install-the-helm-chart" class="md-nav__link">
    3. Install the Helm Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating" class="md-nav__link">
    Updating
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-name-changes" class="md-nav__link">
    Domain Name Changes
  </a>
  
    <nav class="md-nav" aria-label="Domain Name Changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changes-in-github-oauth" class="md-nav__link">
    Changes in GitHub OAuth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changes-in-the-helm-chart" class="md-nav__link">
    Changes in the Helm Chart
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cal-itp/data-infra/edit/main/docs/kubernetes/JupyterHub.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="jupyterhub">JupyterHub<a class="headerlink" href="#jupyterhub" title="Permanent link"> ¶</a></h1>
<p>This page outlines how to deploy JupyterHub to Cal-ITP&rsquo;s Kubernetes cluster.</p>
<p>As we are not yet able to commit encrypted secrets to the cluster, we&rsquo;ll have to do some work ahead of a <code>helm install</code>.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link"> ¶</a></h2>
<h3 id="1-create-the-namespace">1. Create the Namespace<a class="headerlink" href="#1-create-the-namespace" title="Permanent link"> ¶</a></h3>
<div class="highlight"><pre><span></span><code>kubectl create ns jupyterhub
</code></pre></div>
<h3 id="2-add-secrets-to-namespace">2. Add Secrets to Namespace<a class="headerlink" href="#2-add-secrets-to-namespace" title="Permanent link"> ¶</a></h3>
<p>Two base64-encoded secrets must be added to the <code>jupyterhub</code> namespace before installing the Helm chart.</p>
<p>We&rsquo;ll cover the purpose of each secret in the subsections below.</p>
<p>We&rsquo;ll put both of these secrets in a local file, <code>jupyterhub-secrets.yaml</code>, which will contain something that looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">service-key.json</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-base64-encoded-service-key-here&gt;</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyterhub-gcloud-service-key</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyterhub</span>
<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">values.yaml</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-base64-encoded-github-oauth-config-here&gt;</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyterhub-github-config</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jupyterhub</span>
</code></pre></div>
<p>With the above configured, we can go ahead and apply:</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f jupyterhub-secrets.yaml
</code></pre></div>
<p><strong>This file should never be committed!!!</strong></p>
<h4 id="jupyterhub-gcloud-service-key">jupyterhub-gcloud-service-key<a class="headerlink" href="#jupyterhub-gcloud-service-key" title="Permanent link"> ¶</a></h4>
<p>The GCloud service key, a .json file, is used to authenticate users to GCloud.</p>
<p>Currently, the secret <code>jupyterhub-gcloud-service-key</code> is mounted to every JupyterHub user&rsquo;s running container at <code>/usr/local/secrets/service-key.json</code>. As we refine our authentication approach, this secret may become obsolete and may be removed from this process, but for now the process of volume mounting this secret is required for authentication.</p>
<p>To create the base64 encoded string from your terminal:</p>
<div class="highlight"><pre><span></span><code>cat the-service-key.json | base64 -w 0
</code></pre></div>
<p>Then add the terminal&rsquo;s output to the <code>jupyterhub-secrets.yaml</code> outlined above.</p>
<h4 id="jupyterhub-github-config">jupyterhub-github-config<a class="headerlink" href="#jupyterhub-github-config" title="Permanent link"> ¶</a></h4>
<p>Because we use <a href="https://zero-to-jupyterhub.readthedocs.io/en/latest/administrator/authentication.html?highlight=oauth#github">Github OAuth</a> for user authentication in JupyterHub, we have to provide a client-id and client-secret to the JupyterHub Helm chart. We also have to provide a bunch of non-sensitive information to the chart, as well, for GitHub OAuth to function.</p>
<p>For context, here is what the full configuration for the GitHub OAuth in our JupyterHub Helm chart&rsquo;s <code>values.yaml</code> might look like:</p>
<div class="highlight"><pre><span></span><code><span class="nt">hub</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span>
    <span class="nt">GitHubOAuthenticator</span><span class="p">:</span>
      <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-client-id-here&gt;</span>
      <span class="nt">client_secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-client-secret-here&gt;</span>
      <span class="nt">oauth_callback_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://your-jupyterhub-domain/hub/oauth_callback</span>
      <span class="nt">allowed_organizations</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cal-itp:warehouse-users</span>
      <span class="nt">scope</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">read:org</span>
    <span class="nt">JupyterHub</span><span class="p">:</span>
      <span class="nt">authenticator_class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github</span>
      <span class="nt">Authenticator</span><span class="p">:</span>
        <span class="nt">admin_users</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">machow</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">themightchris</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lottspot</span>
</code></pre></div>
<p>Fortunately, we don&rsquo;t have to store all of this information in the secret! The JupyterHub chart affords us the ability to use the <code>hub.existingSecret</code> parameter to pass in the sensitive information, so we can mix-and-match parts of the configuration.</p>
<p>This means that we can leave parameters like <code>hub.config.GitHubOAuthenticator.oauth_callback_url</code> and <code>hub.config.GitHubOAuthenticator.allowed_organizations</code> in plain text in our <code>values.yaml</code>, and place sensitive information like <code>hub.config.GitHubOAuthenticator.client_id</code> and <code>hub.config.GitHubOAuthenticator.client_secret</code> in our <code>jupyterhub-secrets.yaml</code>.</p>
<p>So, what format must our base64 encoded string take in order for the JuptyerHub chart to accept it?</p>
<h5 id="create-a-temporary-file">Create a Temporary File<a class="headerlink" href="#create-a-temporary-file" title="Permanent link"> ¶</a></h5>
<div class="highlight"><pre><span></span><code>touch github-secrets.yaml
</code></pre></div>
<h5 id="fill-the-file-with-chart-formatted-secrets">Fill the File with Chart-Formatted Secrets<a class="headerlink" href="#fill-the-file-with-chart-formatted-secrets" title="Permanent link"> ¶</a></h5>
<p>Your <code>github-secrets.yaml</code> should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">hub</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span>
    <span class="nt">GitHubOAuthenticator</span><span class="p">:</span>
      <span class="nt">client_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-client-id-here&gt;</span>
      <span class="nt">client_secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;your-client-secret-here&gt;</span>
</code></pre></div>
<h5 id="encode-the-file-contents">Encode the File Contents<a class="headerlink" href="#encode-the-file-contents" title="Permanent link"> ¶</a></h5>
<p>From your terminal:</p>
<div class="highlight"><pre><span></span><code>cat github-secrets.yaml | base64 -w 0
</code></pre></div>
<h5 id="add-the-encoding-to-your-secret">Add the Encoding to Your Secret<a class="headerlink" href="#add-the-encoding-to-your-secret" title="Permanent link"> ¶</a></h5>
<p>Add the terminal output from above to your <code>jupyterhub-secrets.yaml</code> file.</p>
<h5 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permanent link"> ¶</a></h5>
<p>From your terminal:</p>
<div class="highlight"><pre><span></span><code>rm github-secrets.yaml
</code></pre></div>
<h4 id="reminder-apply-the-secrets-file">Reminder - Apply the secrets file!<a class="headerlink" href="#reminder-apply-the-secrets-file" title="Permanent link"> ¶</a></h4>
<p>This was a long section, don&rsquo;t forget to apply the following before proceeding.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f jupyterhub-secrets.yaml
</code></pre></div>
<p>After you apply it - you should delete it or keep it somewhere very safe!</p>
<h3 id="3-install-the-helm-chart">3. Install the Helm Chart<a class="headerlink" href="#3-install-the-helm-chart" title="Permanent link"> ¶</a></h3>
<p>You are now ready to install the chart to your cluster using Helm.</p>
<div class="highlight"><pre><span></span><code>helm dependency update  kubernetes/apps/charts/jupyterhub
helm install jupyterhub kubernetes/apps/charts/jupyterhub -n jupyterhub
</code></pre></div>
<h2 id="updating">Updating<a class="headerlink" href="#updating" title="Permanent link"> ¶</a></h2>
<p>In general, any non-secret changes to the chart can be added to / adjusted in the chart&rsquo;s <code>values.yaml</code>.</p>
<p>Upgrade with:</p>
<div class="highlight"><pre><span></span><code># On changes to dependencies in Chart.yaml, remember to re-run:
# helm dependency update kubernetes/apps/charts/jupyterhub
helm upgrade jupyterhub kubernetes/apps/charts/jupyterhub -n jupyterhub
</code></pre></div>
<h2 id="domain-name-changes">Domain Name Changes<a class="headerlink" href="#domain-name-changes" title="Permanent link"> ¶</a></h2>
<p>At the time of this writing, a JupyterHub deployment is available at <code>https://hubtest.k8s.calitp.jarv.us</code>.</p>
<p>If, in the future, the domain name were to change to something more permanent, some configuration would have to change. Fortunately, though, none of the secrets we covered above are affected by these configuration changes!</p>
<p>It is advised the below changes are planned and executed in a coordinated effort.</p>
<h3 id="changes-in-github-oauth">Changes in GitHub OAuth<a class="headerlink" href="#changes-in-github-oauth" title="Permanent link"> ¶</a></h3>
<p>Within the GitHub OAuth application, in Github, the homepage and callback URLs would need to be changed. Cal-ITP owns the Github OAUth application in GitHub, and <a href="https://github.com/cal-itp/data-infra/issues/367">this Cal-ITP Github issue</a> can be referenced for individual contributors who may be able to helm adjusting the Github OAUth application&rsquo;s homepage and callback URLs.</p>
<h3 id="changes-in-the-helm-chart">Changes in the Helm Chart<a class="headerlink" href="#changes-in-the-helm-chart" title="Permanent link"> ¶</a></h3>
<p>After the changes have been made to the GitHub OAuth application, the following portions of the JupyterHub chart&rsquo;s <code>values.yaml</code> must be changed:</p>
<ul>
<li><code>hub.config.GitHubOAuthenticator.oauth_callback_url</code></li>
<li><code>ingress.hosts</code></li>
<li><code>ingress.tls.hosts</code></li>
</ul>
<p>Apply these chart changes with:</p>
<div class="highlight"><pre><span></span><code>helm upgrade jupyterhub kubernetes/apps/charts/jupyterhub -n jupyterhub
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: kubernetes #" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              kubernetes #
            </div>
          </div>
        </a>
      
      
        
        <a href="../../services/gtfs-ckan-uploader/" class="md-footer__link md-footer__link--next" aria-label="Next: GTFS CKAN Uploader" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              GTFS CKAN Uploader
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e84347e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>